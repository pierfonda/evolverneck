#include "generic_functions.el"

//qantity stretch energy method linear_elastic global
quantity bend energy modulus 1 method star_perp_sq_mean_curvature global

INTEGRAL_ORDER_1D 12
INTEGRAL_ORDER_2D 7

// ***** PARAMETERS *****

PARAMETER  EPS = .3

PARAMETER  Z0LIM = -.02

PARAMETER  DIST = .56

PARAMETER  RADX = 1
PARAMETER  RADY = 1
PARAMETER  RADZ = 1

PARAMETER  RINX = EPS*RADX
PARAMETER  RINY = EPS*RADY

PARAMETER  LX = 1.01*RADX
PARAMETER  LY = 1.01*RADY

PARAMETER  L2X = 5.5*RADZ
PARAMETER  L2Y = 5.5*RADZ

PARAMETER  SQ2 = sqrt(2.)
 	
// ***** BOUNDARY *****

// ***** CONSTRAINTS *****

// Mirror plane constraints


constraint 1 nonnegative global
formula: x^2/RADX^2 + y^2/RADY^2 + (z-DIST-RADZ)^2/RADZ^2 - 1 = 0

constraint 2 nonnegative global
formula: z = Z0LIM

// For viewing multiple copies of the fundamental region

view_transform_generators 2
// generator A: reflection in x_mirror
-1 0 0 0
0 1 0 0
0 0 1 0
0 0 0 1

// generator B: reflection in y_mirror
1  0 0 0 
0  -1 0 0
0  0 1 0
0  0 0 1

// ***** BOUNDARY *****

vertices   

1 	LX	    	0	    	DIST+2.01*RADZ 
2 	LX/SQ2		LY/SQ2		DIST+2.01*RADZ
3 	0	    	LY	    	DIST+2.01*RADZ
4	-LX/SQ2		LY/SQ2	    	DIST+2.01*RADZ 
5 	-LX		0		DIST+2.01*RADZ
6 	-LX/SQ2		-LY/SQ2	    	DIST+2.01*RADZ
7 	0	    	-LY	    	DIST+2.01*RADZ 
8 	LX/SQ2		-LY/SQ2		DIST+2.01*RADZ

11 	LX	    	0	    	DIST
12 	LX/SQ2		LY/SQ2		DIST
13 	0	    	LY	    	DIST
14	-LX/SQ2		LY/SQ2	    	DIST
15 	-LX		0		DIST
16 	-LX/SQ2		-LY/SQ2	    	DIST
17 	0	    	-LY	    	DIST
18 	LX/SQ2		-LY/SQ2		DIST

21 	RINX	    	0	    	2*DIST/3
22 	RINX/SQ2	RINY/SQ2	2*DIST/3
23 	0	    	RINY	    	2*DIST/3
24	-RINX/SQ2	RINY/SQ2    	2*DIST/3
25 	-RINX		0		2*DIST/3
26 	-RINX/SQ2	-RINY/SQ2    	2*DIST/3
27 	0	    	-RINY	    	2*DIST/3
28 	RINX/SQ2	-RINY/SQ2	2*DIST/3

31 	RINX	    	0	    	DIST/3
32 	RINX/SQ2	RINY/SQ2	DIST/3
33 	0	    	RINY	    	DIST/3
34	-RINX/SQ2	RINY/SQ2    	DIST/3
35 	-RINX		0		DIST/3
36 	-RINX/SQ2	-RINY/SQ2    	DIST/3
37 	0	    	-RINY	    	DIST/3
38 	RINX/SQ2	-RINY/SQ2	DIST/3

41 	3*RINX	    	0	    	0
42 	3*RINX/SQ2	3*RINY/SQ2	0
43 	0	    	3*RINY	    	0
44	-3*RINX/SQ2	3*RINY/SQ2    	0
45 	-3*RINX		0		0
46 	-3*RINX/SQ2	-3*RINY/SQ2    	0
47 	0	    	-3*RINY	    	0
48 	3*RINX/SQ2	-3*RINY/SQ2	0


51 	L2X	    	0	    	0	fixed
52 	L2X/SQ2		L2Y/SQ2		0	fixed
53 	0	    	L2Y	    	0	fixed
54	-L2X/SQ2	L2Y/SQ2    	0	fixed
55 	-L2X		0		0	fixed
56 	-L2X/SQ2	-L2Y/SQ2    	0	fixed
57 	0	    	-L2Y	    	0	fixed
58 	L2X/SQ2		-L2Y/SQ2	0	fixed


edges:

1 1 2		
2 2 3
3 3 4		
4 4 5
5 5 6		
6 6 7
7 7 8		
8 8 1

10 1 11	
20 2 12
30 3 13		
40 4 14
50 5 15	
60 6 16
70 7 17	
80 8 18

11 11 12
12 12 13
13 13 14
14 14 15
15 15 16
16 16 17
17 17 18
18 18 11

110 11 21	
120 12 22
130 13 23		
140 14 24
150 15 25	
160 16 26
170 17 27	
180 18 28

21 21 22
22 22 23
23 23 24
24 24 25
25 25 26
26 26 27
27 27 28
28 28 21

210 21 31	
220 22 32
230 23 33		
240 24 34
250 25 35	
260 26 36
270 27 37	
280 28 38

31 31 32
32 32 33
33 33 34
34 34 35
35 35 36
36 36 37
37 37 38
38 38 31

310 31 41	
320 32 42
330 33 43		
340 34 44
350 35 45	
360 36 46
370 37 47	
380 38 48

41 41 42
42 42 43
43 43 44
44 44 45
45 45 46
46 46 47
47 47 48
48 48 41

410 41 51	
420 42 52
430 43 53		
440 44 54
450 45 55	
460 46 56
470 47 57	
480 48 58

51 51 52 fixed
52 52 53 fixed
53 53 54 fixed
54 54 55 fixed
55 55 56 fixed
56 56 57 fixed 
57 57 58 fixed 
58 58 51 fixed


faces 

1 1 2 3 4 5 6 7 8

11 -1 10 11 -20
12 -2 20 12 -30
13 -3 30 13 -40
14 -4 40 14 -50
15 -5 50 15 -60
16 -6 60 16 -70
17 -7 70 17 -80
18 -8 80 18 -10

21 -11 110 21 -120
22 -12 120 22 -130
23 -13 130 23 -140
24 -14 140 24 -150
25 -15 150 25 -160
26 -16 160 26 -170
27 -17 170 27 -180
28 -18 180 28 -110

31 -21 210 31 -220
32 -22 220 32 -230
33 -23 230 33 -240
34 -24 240 34 -250
35 -25 250 35 -260
36 -26 260 36 -270
37 -27 270 37 -280
38 -28 280 38 -210

41 -31 310 41 -320
42 -32 320 42 -330
43 -33 330 43 -340
44 -34 340 44 -350
45 -35 350 45 -360
46 -36 360 46 -370
47 -37 370 47 -380
48 -38 380 48 -310

/*
2 -48 -47 -46 -45 -44 -43 -42 -41
*/


51 -41 410 51 -420
52 -42 420 52 -430
53 -43 430 53 -440
54 -44 440 54 -450
55 -45 450 55 -460
56 -46 460 56 -470
57 -47 470 57 -480
58 -48 480 58 -410


// ***** MAIN *****

read

//check_increase ON;

set_density(0);
post_project;
set facets frontcolor lightcyan;
set facets backcolor yellow;	

poea := {project_on_ellipse_above(RADX,RADY,RADZ,DIST,.99*DIST)};

namo7 := {poea 2; r; g 100;  u; ggm(0,200); r; u; ggm(0,200); U; poea;  {n .5; u; ggm(0,200);} 5}	
